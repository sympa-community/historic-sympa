<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2002-2-1 (1.70)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>15. virtual host</TITLE>
<META NAME="description" CONTENT="15. virtual host">
<META NAME="keywords" CONTENT="sympa">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<META NAME="Generator" CONTENT="LaTeX2HTML v2002-2-1">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="sympa.css">

<LINK REL="next" HREF="node17.html">
<LINK REL="previous" HREF="node15.html">
<LINK REL="up" HREF="sympa.html">
<LINK REL="next" HREF="node17.html">
</HEAD>

<BODY TEXT="#000000" BGCOLOR="#ffffff">
<!--Navigation Panel-->
<A NAME="tex2html1259"
  HREF="node17.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html1253"
  HREF="sympa.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html1247"
  HREF="node15.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html1255"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html1257"
  HREF="node31.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html1260"
  HREF="node17.html">16. Interaction between Sympa and other</A>
<B> Up:</B> <A NAME="tex2html1254"
  HREF="sympa.html">Sympa Mailing Lists Management Software version</A>
<B> Previous:</B> <A NAME="tex2html1248"
  HREF="node15.html">14. Authorization scenarios</A>
 &nbsp; <B>  <A NAME="tex2html1256"
  HREF="node1.html">Contents</A></B> 
 &nbsp; <B>  <A NAME="tex2html1258"
  HREF="node31.html">Index</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL>
<LI><A NAME="tex2html1261"
  HREF="node16.html#SECTION001610000000000000000">15.1 How to create a virtual host</A>
<LI><A NAME="tex2html1262"
  HREF="node16.html#SECTION001620000000000000000">15.2 robot.conf</A>
<UL>
<LI><A NAME="tex2html1263"
  HREF="node16.html#SECTION001621000000000000000">15.2.1 Robot customization</A>
</UL>
<BR>
<LI><A NAME="tex2html1264"
  HREF="node16.html#SECTION001630000000000000000">15.3 Managing multiple virtual hosts</A>
</UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A NAME="SECTION001600000000000000000"></A>
    <A NAME="virtual-robot"></A>
<BR>
15. virtual host
</H1>

<P>
Sympa is designed to manage multiple distinct mailing list servers on
a single host with a single Sympa installation. Sympa virtual hosts
are like Apache virtual hosting. Sympa virtual host definition includes
a specific email address for the robot itself and its lists and also a virtual
http server. Each robot provides access to a set of lists, each list is
related to only one robot.

<P>
Most configuration parameters can be redefined for each robot except 
general Sympa installation parameters (binary and spool location, smtp engine,
antivirus plugging,...).

<P>
The virtual host name as defined in <I>Sympa</I> documentation and configuration file refers
to the Internet domaine of the virtual host.

<P>
Note that the main limitation of virtual hosts in Sympa is that you cannot create 
2 lists with the same name (local part) among your virtual hosts.

<P>

<H1><A NAME="SECTION001610000000000000000">
15.1 How to create a virtual host</A>
</H1>

<P>
You don't need to install several Sympa servers. A single <A NAME="9789"></A><TT>sympa.pl</TT> daemon
and one or more fastcgi servers can serve all virtual host. Just configure the 
server environment in order to accept the new domain definition.

<UL>
<LI><B>The DNS</B> must be configured to define a new mail exchanger record (MX) 
to route message to your server. A new host (A record) or alias (CNAME) are mandatory
to define the new web server.
</LI>
<LI>Configure your <B>MTA (sendmail, postfix, exim, ...)</B> to accept incoming 
messages for the new robot domain. Add mail aliases for the robot :

<P>
<I>Examples (with sendmail):</I> <PRE>
sympa@your.virtual.domain:      "| /usr/local/sympa-os/bin/queue sympa@your.virtual.domain"
listmaster@your.virtual.domain: "| /usr/local/sympa-os/bin/queue listmaster@your.virtual.domain"
bounce+*@your.virtual.domain:          "| /usr/local/sympa-os/bin/bouncequeue sympa@your.virtual.domain"\\
</PRE>

<P>
</LI>
<LI>Define a <B>virtual host in your HTTPD server</B>. The fastcgi servers defined 
in the common section of you httpd server can be used by each virtual host. You don't 
need to run dedicated fascgi server for each virtual host.

<P>
<I>Examples:</I> <PRE>
FastCgiServer /usr/local/sympa-os/bin/wwsympa.fcgi -processes 3 -idle-timeout 120
.....
&lt;VirtualHost 195.215.92.16&gt;
  ServerAdmin webmaster@your.virtual.domain
  DocumentRoot /var/www/your.virtual.domain
  ServerName your.virtual.domain

  &lt;Location /sympa&gt;
     SetHandler fastcgi-script
  &lt;/Location&gt;

  ScriptAlias /sympa /usr/local/sympa-os/bin/wwsympa.fcgi

  Alias /static-sympa /usr/local/sympa-os/your.virtual.domain/static_content

&lt;/VirtualHost&gt;
</PRE>

<P>
</LI>
<LI>Create a <A NAME="9792"></A><TT>/usr/local/sympa-os/etc/your.virtual.domain/robot.conf</TT> configuration file for the virtual host. Its format is a subset of <A NAME="9795"></A><TT>sympa.conf</TT> and is described in the next section ; a sample <A NAME="9798"></A><TT>robot.conf</TT> is provided.

<P>
</LI>
<LI>Create a <A NAME="9801"></A><TT>/usr/local/sympa-os/expl/your.virtual.domain/</TT> directory that will contain the virtual host mailing lists directories. This directory should have the  <I>sympa</I> user as its owner and must have read and write access for this user.

<P><PRE>
# su sympa -c 'mkdir /usr/local/sympa-os/expl/your.virtual.domain'
# chmod 750 /usr/local/sympa-os/expl/your.virtual.domain
</PRE>

<P>
</LI>
</UL>

<P>

<H1><A NAME="SECTION001620000000000000000">
15.2 robot.conf</A>
</H1>
A robot is named by its domain, let's say my.domain.organd defined by a directory 
<A NAME="9804"></A><TT>/usr/local/sympa-os/etc/my.domain.org</TT>. This directory must contain at least a 
<A NAME="9807"></A><TT>robot.conf</TT> file. This files has the same format as  <A NAME="9810"></A><TT>/usr/local/sympa-os/etc/sympa.conf</TT>
(have a look at robot.conf in the sample dir).
Only the following parameters can be redefined for a particular robot :

<P>

<UL>
<LI><A NAME="9813"></A><TT>http_host</TT> 
<BR>
This hostname will be compared with 'SERVER_NAME' environment variable in wwsympa.fcgi
	to determine the current Virtual Host. You can a path at the end of this parameter if
	you are running multiple virtual hosts on the same host. 
	<PRE>Examples: \\
	http_host  myhost.mydom
	http_host  myhost.mydom/sympa
</PRE>

<P>
</LI>
<LI><A NAME="9816"></A><TT>host</TT> 
<BR>
This is the equivalent of the <A NAME="9819"></A><TT>host</TT> sympa.conf parameter.
	The default for this parameter is the name of the virtual host (ie the name of the subdirectory).

<P>
</LI>
<LI><A NAME="9822"></A><TT>wwsympa_url</TT> 
<BR>
The base URL of WWSympa

<P>
</LI>
<LI><A NAME="9825"></A><TT>soap_url</TT> 
<BR>
The base URL of Sympa's SOAP server (if it is running ; see&nbsp;<A HREF="node13.html#soap">12</A>, page&nbsp;<A HREF="node13.html#soap"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A>)

<P>
</LI>
<LI><A NAME="9828"></A><TT>cookie_domain</TT>

<P>
</LI>
<LI><A NAME="9831"></A><TT>email</TT>

<P>
</LI>
<LI><A NAME="9834"></A><TT>title</TT>

<P>
</LI>
<LI><A NAME="9837"></A><TT>default_home</TT>

<P>
</LI>
<LI><A NAME="9840"></A><TT>create_list</TT>

<P>
</LI>
<LI><A NAME="9843"></A><TT>lang</TT>

<P>
</LI>
<LI><A NAME="9846"></A><TT>supported_lang</TT>

<P>
</LI>
<LI><A NAME="9849"></A><TT>log_smtp</TT>

<P>
</LI>
<LI><A NAME="9852"></A><TT>listmaster</TT>

<P>
</LI>
<LI><A NAME="9855"></A><TT>max_size</TT>

<P>
</LI>
<LI><A NAME="9858"></A><TT>css_path</TT>

<P>
</LI>
<LI><A NAME="9861"></A><TT>css_url</TT>

<P>
</LI>
<LI><A NAME="9864"></A><TT>static_content_path</TT>

<P>
</LI>
<LI><A NAME="9867"></A><TT>static_content_url</TT>

<P>
</LI>
<LI><A NAME="9870"></A><TT>pictures_feature</TT>

<P>
</LI>
<LI><A NAME="9873"></A><TT>pictures_max_size</TT>

<P>
</LI>
<LI><A NAME="9876"></A><TT>logo_html_definition</TT>

<P>
</LI>
<LI><A NAME="9879"></A><TT>color_0</TT>, color_1 ... color_15

<P>
</LI>
<LI>deprecated color definition <A NAME="9882"></A><TT>dark_color</TT>, <A NAME="9885"></A><TT>light_color</TT>, <A NAME="9888"></A><TT>text_color</TT>, <A NAME="9891"></A><TT>bg_color</TT>, <A NAME="9894"></A><TT>error_color</TT>, <A NAME="9897"></A><TT>selected_color</TT>, <A NAME="9900"></A><TT>shaded_color</TT>

<P>
</LI>
</UL>

<P>
These settings overwrite the equivalent global parameter defined in <A NAME="9903"></A><TT>/usr/local/sympa-os/etc/sympa.conf</TT>
for my.domain.orgrobot ; the main <A NAME="9906"></A><TT>listmaster</TT> still has privileges on Virtual
Robots though. The http_host parameter is compared by wwsympa with the SERVER_NAME
environment variable to recognize which robot is in used. 

<P>

<H2><A NAME="SECTION001621000000000000000">
15.2.1 Robot customization</A>
</H2>

<P>
In order to customize the web look and feel, you may edit the CSS definition. CSS are defined in a template named css.tt2. Any robot can use static css file for making Sympa web interface faster. Then you can edit this static definition and change web style. Please refer to  <A NAME="9909"></A><TT>css_path</TT> <A NAME="9912"></A><TT>css_url</TT>. You can also quickly introduce a logo in left top corner of all pages configuring <A NAME="9915"></A><TT>logo_html_definition</TT> parameter in robot.conf file. 

<P>
In addition, if needed, you can customize each virtual host using its set of templates and authorization scenarios. 

<P>
<A NAME="9918"></A><TT>/usr/local/sympa-os/etc/my.domain.org/web_tt2/</TT>,
<A NAME="9921"></A><TT>/usr/local/sympa-os/etc/my.domain.org/mail_tt2/</TT>, 
<A NAME="9924"></A><TT>/usr/local/sympa-os/etc/my.domain.org/scenari/</TT> directories are searched when
loading templates or scenari before searching into <A NAME="9927"></A><TT>/usr/local/sympa-os/etc</TT> and  <A NAME="9930"></A><TT>/usr/local/sympa-os/bin/etc</TT>. This allows to define different privileges and a different GUI for a Virtual Host.

<P>

<H1><A NAME="SECTION001630000000000000000">
15.3 Managing multiple virtual hosts</A>
</H1>

<P>
If you are managing more than 2 virtual hosts, then you might cinsider moving all the mailing lists in the default
robot to a dedicated virtual host located in the <A NAME="9933"></A><TT>/usr/local/sympa-os/expl/my.domain.org/</TT> directory. The main benefit of 
this organisation is the ability to define default configuration elements (templates or authorization scenarios) 
for this robot without inheriting them within other virtual hosts.

<P>
To create such a virtual host, you need to create <A NAME="9936"></A><TT>/usr/local/sympa-os/expl/my.domain.org/</TT> and <A NAME="9939"></A><TT>/usr/local/sympa-os/etc/my.domain.org/</TT> directories ; 
customize <A NAME="9942"></A><TT>host</TT>, <A NAME="9945"></A><TT>http_host</TT> and <A NAME="9948"></A><TT>wwsympa_url</TT> parameters in the <A NAME="9951"></A><TT>/usr/local/sympa-os/etc/my.domain.org/robot.conf</TT> 
with the same values as the default robot (as defined in <A NAME="9954"></A><TT>sympa.conf</TT> and <A NAME="9957"></A><TT>wwsympa.conf</TT> files).

<P>

<HR>
<!--Navigation Panel-->
<A NAME="tex2html1259"
  HREF="node17.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html1253"
  HREF="sympa.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html1247"
  HREF="node15.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html1255"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html1257"
  HREF="node31.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html1260"
  HREF="node17.html">16. Interaction between Sympa and other</A>
<B> Up:</B> <A NAME="tex2html1254"
  HREF="sympa.html">Sympa Mailing Lists Management Software version</A>
<B> Previous:</B> <A NAME="tex2html1248"
  HREF="node15.html">14. Authorization scenarios</A>
 &nbsp; <B>  <A NAME="tex2html1256"
  HREF="node1.html">Contents</A></B> 
 &nbsp; <B>  <A NAME="tex2html1258"
  HREF="node31.html">Index</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
root
2006-11-21
</ADDRESS>
</BODY>
</HTML>
