
<H1><A NAME="SECTION002000000000000000000"><tex2html_anchor_invisible_mark></A>
    <A NAME="lists-families"><tex2html_anchor_mark></A>    <A NAME="2556"><tex2html_anchor_invisible_mark></A><BR>
19. Lists Families
</H1>

<P>
A list can have from three parameters to many tens of them. Some listmasters need to create 
a set of lists that have the same profile. In order to simplify the apprehension of these parameters, 
list families define a lists typology.
Families provide a new level for defaults : in the past, defaults in Sympa were global and 
most sites using Sympa needed multiple defaults for different group of lists.
Moreover families allow listmaster to delegate a part of configuration list to owners, in a controlled way 
according to family properties.
Distribution will provide defaults families.

<P>

<H1><A NAME="SECTION002010000000000000000"><tex2html_anchor_invisible_mark></A>
     <A NAME="family-concept"><tex2html_anchor_mark></A><BR>
19.1 Family concept
</H1>

<P>
A family provides a model for all of its lists. It is specified by the following characteristics :

<P>

<UL>
<LI>a list creation template providing a common profile for each list configuration file.
</LI>
<LI>an degree of independence between the lists and the family : list parameters edition rights and 
constraints on these parameters can be <I>free</I> (no constraint), <I>controlled</I> (a set of 
available values is defined for these parameters) or <I>fixed</I> (the value for the parameter is imposed by 
the family). That prevents lists from diverging from the original and it allows list owner customizations in 
a controlled way. 
</LI>
<LI>a filiation kept between lists and family all along the list life : family modifications 
are applied on lists while keeping listowners customizations.

<P>
</LI>
</UL>

<P>
Here is a list of operation performed on a family : 

<P>

<UL>
<LI>definition : definition of the list creation template, the degree of independence and family customizations.
</LI>
<LI>instantiation : lists creation or modifications of existing lists while respecting family properties.
          The set of data defining the lists is an XML document. 
</LI>
<LI>modification : modification of family properties. The modification is effective at the next instantiation time, that have consequences on every list.
</LI>
<LI>closure : closure of each list.
</LI>
<LI>adding one list to a family.
</LI>
<LI>closing one family list.
</LI>
<LI>modifying one family list.

<P>
</LI>
</UL>

<P>

<H1><A NAME="SECTION002020000000000000000"><tex2html_anchor_invisible_mark></A>
    <A NAME="using-family"><tex2html_anchor_mark></A><BR>
19.2 Using family
</H1>

<P>

<H2><A NAME="SECTION002021000000000000000">
19.2.1 Definition</A>
</H2>
Families can be defined at the robot level, at  the site level or on the distribution level
 (where default families are provided).
So, you have to create a sub directory named after the family's name in a <A NAME="9420"><tex2html_anchor_invisible_mark></A><TT>families</TT> directory  : 

<P>
<I>Examples:</I> 
<BLOCKQUOTE>
</BLOCKQUOTE><PRE><tex2html_verbatim_mark>verbatim350#</PRE><BLOCKQUOTE>
</BLOCKQUOTE>
In this directory you must provide these files :

<UL>
<LI><A NAME="9423"><tex2html_anchor_invisible_mark></A><TT>config.tt2</TT> (mandatory)
</LI>
<LI><A NAME="9426"><tex2html_anchor_invisible_mark></A><TT>param_constraint.conf</TT> (mandatory)
</LI>
<LI><A NAME="9429"><tex2html_anchor_invisible_mark></A><TT>edit_list.conf</TT>
</LI>
<LI>customizable files
</LI>
</UL>

<P>

<H3><A NAME="SECTION002021100000000000000"><tex2html_anchor_invisible_mark></A>
   <A NAME="using-family-config-tpl"><tex2html_anchor_mark></A><BR>
19.2.1.1 config.tt2
</H3>
      This is a list creation template, this file is mandatory. It provides default values for parameters. 
      This file is an almost complete list configuration, with a number of missing fields 
      (such as owner e-mail) to be replaced by data obtained at the time of family instantiation.
      It is easy to create new list templates by modifying existing ones. See <A HREF=<tex2html_cr_mark>#list-tpl#2582><tex2html_cr_mark></A>, page~<A HREF=<tex2html_cr_mark>#list-tpl#2583><tex2html_cross_ref_visible_mark></A>
      and <A HREF=<tex2html_cr_mark>#tpl-format#2584><tex2html_cr_mark></A>, page~<A HREF=<tex2html_cr_mark>#tpl-format#2585><tex2html_cross_ref_visible_mark></A>.
<BR>
<P>
<I>Example:</I> 
<BLOCKQUOTE>
</BLOCKQUOTE><PRE><tex2html_verbatim_mark>verbatim351#</PRE><BLOCKQUOTE>
</BLOCKQUOTE>

<P>

<H3><A NAME="SECTION002021200000000000000"><tex2html_anchor_invisible_mark></A>
     <A NAME="2592"><tex2html_anchor_invisible_mark></A><BR>
19.2.1.2 param_constraint.conf
</H3>
         This file is obligatory. It defines constraints on parameters. There are three kind of constraints :
	 
<UL>
<LI><I>free</I> parameters : no constraint on these parameters, 
                  they are not written in the <A NAME="9432"><tex2html_anchor_invisible_mark></A><TT>param_constraint.conf</TT> file.
</LI>
<LI><I>controlled</I> parameters : these parameters must select their values 
                  in a set of available values indicated in the <A NAME="9435"><tex2html_anchor_invisible_mark></A><TT>param_constraint.conf</TT> file.
</LI>
<LI><I>fixed</I> parameters : these parameters must have the imposed value indicated
	          in the <A NAME="9438"><tex2html_anchor_invisible_mark></A><TT>param_constraint.conf</TT> file.

<P>
</LI>
</UL>
	 The parameters constraints will be checked at every list loading.

<P>
<B>WARNING</B> : Some parameters cannot be constrained, they are : <A NAME="9441"><tex2html_anchor_invisible_mark></A><TT>owner_include.source_parameter</TT> 
(see~<A HREF=<tex2html_cr_mark>#par-owner-include#2603><tex2html_cr_mark></A>, page~<A HREF=<tex2html_cr_mark>#par-owner-include#2604><tex2html_cross_ref_visible_mark></A>), <A NAME="9444"><tex2html_anchor_invisible_mark></A><TT>editor_include.source_parameter</TT> (see~<A HREF=<tex2html_cr_mark>#par-editor-include#2606><tex2html_cr_mark></A>, page~<A HREF=<tex2html_cr_mark>#par-editor-include#2607><tex2html_cross_ref_visible_mark></A>). About <A NAME="9447"><tex2html_anchor_invisible_mark></A><TT>digest</TT> parameter (see~<A HREF=<tex2html_cr_mark>#par-digest#2609><tex2html_cr_mark></A>, page~<A HREF=<tex2html_cr_mark>#par-digest#2610><tex2html_cross_ref_visible_mark></A>) , just days can be constrained.

<P>
<I>Example:</I> 
<BLOCKQUOTE>
</BLOCKQUOTE><PRE><tex2html_verbatim_mark>verbatim352#</PRE><BLOCKQUOTE>
</BLOCKQUOTE>

<P>

<H3><A NAME="SECTION002021300000000000000">
19.2.1.3 edit_list.conf</A>
</H3>
        This is an optional file. It defines which parameters/files are editable by
	owners. See <A HREF=<tex2html_cr_mark>#list-edition#2617><tex2html_cr_mark></A>, page~<A HREF=<tex2html_cr_mark>#list-edition#2618><tex2html_cross_ref_visible_mark></A>.
	If the family does not have this file, <I>Sympa</I> will look for 
	the one defined on robot level, server site level or distribution level. 
	(This file already exists without family context)
<BR>	Notes that by default parameter family_name is not writable, you should not change 
	this edition right.

<P>

<H3><A NAME="SECTION002021400000000000000">
19.2.1.4 customizable files</A>
</H3>
        Families provides a new level of customization for scenarios (see <A HREF=<tex2html_cr_mark>#scenarios#2621><tex2html_cr_mark></A>, 
	page~<A HREF=<tex2html_cr_mark>#scenarios#2622><tex2html_cross_ref_visible_mark></A>), templates for service messages (see <A HREF=<tex2html_cr_mark>#site-tpl#2623><tex2html_cr_mark></A>, 
	page~<A HREF=<tex2html_cr_mark>#site-tpl#2624><tex2html_cross_ref_visible_mark></A>) and templates for web pages (see <A HREF=<tex2html_cr_mark>#web-tpl#2625><tex2html_cr_mark></A> , 
	page~<A HREF=<tex2html_cr_mark>#web-tpl#2626><tex2html_cross_ref_visible_mark></A>). <I>Sympa</I> looks for these files in the following 
	level order: list, family, robot, server site or distribution. 

<P>

<H2><A NAME="SECTION002022000000000000000"><tex2html_anchor_invisible_mark></A>
<A NAME="family-instantiation"><tex2html_anchor_mark></A><BR>
19.2.2 Instantiation
</H2>

<P>
Instantiation permits to generate lists.You must provide an XML file that is 
composed of lists description, the root element is <I>family</I> and is only 
composed of <I>list</I> elements. List elements are described in section 
<A HREF=<tex2html_cr_mark>#list-creation-sympa#2632><tex2html_cr_mark></A>, page~<A HREF=<tex2html_cr_mark>#list-creation-sympa#2633><tex2html_cross_ref_visible_mark></A>. Each list is described 
by the set of values for affectation list parameters.

<P>
Here is an sample command to instantiate a family :
<BLOCKQUOTE>
</BLOCKQUOTE><PRE><tex2html_verbatim_mark>verbatim353#</PRE><BLOCKQUOTE>
</BLOCKQUOTE>
This means lists that belong to family <A NAME="9450"><tex2html_anchor_invisible_mark></A><TT>my_family</TT> will be created under the robot 
<A NAME="9453"><tex2html_anchor_invisible_mark></A><TT>my_robot</TT> and these lists are described in the file <A NAME="9456"><tex2html_anchor_invisible_mark></A><TT>my_file.xml</TT>. Sympa will split this file 
into several xml files describing lists. Each list XML file is put in each list directory.
<BR>
<P>
<I>Example:</I> 
<BLOCKQUOTE>
</BLOCKQUOTE><PRE><tex2html_verbatim_mark>verbatim354#</PRE><BLOCKQUOTE>
</BLOCKQUOTE>

<P>
Each instantiation describes lists. Compared to the previous instantiation, there are three cases :

<UL>
<LI>lists creation : new lists described by the new instantiation
</LI>
<LI>lists modification : lists already existing but possibly changed because of changed parameters values in
        the XML file or because of changed family's properties.
</LI>
<LI>lists removal : lists nomore described by the new instantiation. In this case, the listmaster must 
        valid his choice on command line. If the list is removed, it is set in status <A NAME="9459"><tex2html_anchor_invisible_mark></A><TT>family_closed</TT>, or if the 
	list is recovered, the list XML file from the previous instantiation is got back to go on as a list modification then.

<P>
</LI>
</UL>

<P>
After list creation or modification, parameters constraints are checked :

<UL>
<LI><I>fixed</I> parameter : the value must be the one imposed.
</LI>
<LI><I>controlled</I> parameter : the value must be one of the set of available values.
</LI>
<LI><I>free</I> parameter : there is no checking.

<P>
</LI>
</UL>

<P>
diagram

<P>
In case of modification (see diagram), allowed customizations can be preserved :

<UL>
<LI>(1) : for every modified parameters (via Web interface), noted in the <A NAME="9462"><tex2html_anchor_invisible_mark></A><TT>config_changes</TT> 
    file, values can be collected in the old list configuration file, according to new family properties :
    
<UL>
<LI><I>fixed</I> parameter : the value is not collected.
</LI>
<LI><I>controlled</I> parameter : the value is collected only if constraints are respected.
</LI>
<LI><I>free</I> parameter : the value is collected.
    
</LI>
</UL>
</LI>
<LI>(2) : a new list configuration file is made with the new family properties
</LI>
<LI>(3) : collected values are set in the new list configuration file.

<P>
</LI>
</UL>

<P>
Notes : 

<UL>
<LI>For each list problem (as family file error, error parameter constraint, error instanciation ...),
    the list is set in status <A NAME="9465"><tex2html_anchor_invisible_mark></A><TT>error_config</TT> and the listmaster is notified. He will have to do necessary to put list in use.
</LI>
<LI>For each list closing in family context, the list is set in status <A NAME="9468"><tex2html_anchor_invisible_mark></A><TT>family_closed</TT> and the owner is notified.
</LI>
<LI>For each overwritten list customization, the owner is notified. 
</LI>
</UL>

<P>

<H2><A NAME="SECTION002023000000000000000">
19.2.3 Modification</A>
</H2>
To modify a family, you have to edit family files manually. The modification will be effective while the next instanciation.
<BR><B>WARNING</B>: The family modification must be done just before an instantiation. If it is not, alive lists wouldn't respect 
new family properties and they would be set in status error_config immediately.

<P>

<H2><A NAME="SECTION002024000000000000000">
19.2.4 Closure</A>
</H2>

<P>
<A NAME="family-closure"><tex2html_anchor_mark></A>
<P>
Closes every list (installed under the indicated robot) 
 of this family : lists status are set to <A NAME="9471"><tex2html_anchor_invisible_mark></A><TT>family_closed</TT>, aliases are 
 removed and subscribers are removed from DB. (a dump is created in the list 
 directory to allow restoration of the list).

<P>
Here is a sample command to close a family :
 <BLOCKQUOTE>
</BLOCKQUOTE><PRE><tex2html_verbatim_mark>verbatim355#</PRE><BLOCKQUOTE>
</BLOCKQUOTE> 

<P>

<H2><A NAME="SECTION002025000000000000000">
19.2.5 Adding one list</A>
</H2>

<P>
<A NAME="family-add-list"><tex2html_anchor_mark></A>
<P>
Adds a list to the family without instantiate all the family. The list is created
 as if it was created during an instantiation, under the indicated robot. The XML file
 describes the list and the root element is <A NAME="9474"><tex2html_anchor_invisible_mark></A><TT>;SPMlt;list;SPMgt;</TT>. List elements are described in section 
 <A HREF=<tex2html_cr_mark>#list-creation-sympa#2678><tex2html_cr_mark></A>, page~<A HREF=<tex2html_cr_mark>#list-creation-sympa#2679><tex2html_cross_ref_visible_mark></A>.

<P>
Here is a sample command to add a list to a family :
 <BLOCKQUOTE>
</BLOCKQUOTE><PRE><tex2html_verbatim_mark>verbatim356#</PRE><BLOCKQUOTE>
</BLOCKQUOTE> 

<P>

<H2><A NAME="SECTION002026000000000000000">
19.2.6 Removing one list</A>
</H2>

<P>
Closes the list  installed under the indicated robot : the list status is set to
  <A NAME="9477"><tex2html_anchor_invisible_mark></A><TT>family_closed</TT>, aliases are 
 removed and subscribers are removed from DB. (a dump is created in the list 
 directory to allow restoring the list).

<P>
Here is a sample command to close a list family (same as an orphan list) :
 <BLOCKQUOTE>
</BLOCKQUOTE><PRE><tex2html_verbatim_mark>verbatim357#</PRE><BLOCKQUOTE>
</BLOCKQUOTE> 

<P>

<H2><A NAME="SECTION002027000000000000000"><tex2html_anchor_invisible_mark></A>
 <A NAME="family-modify-list"><tex2html_anchor_mark></A><BR>
19.2.7 Modifying one list
</H2>

<P>
Modifies a family list without instantiating the whole family. The list (installed under the indicated robot) 
 is modified as if it was modified during an instantiation. The XML file
 describes the list and the root element is <A NAME="9480"><tex2html_anchor_invisible_mark></A><TT>;SPMlt;list;SPMgt;</TT>. List elements are described in section 
 <A HREF=<tex2html_cr_mark>#list-creation-sympa#2693><tex2html_cr_mark></A>, page~<A HREF=<tex2html_cr_mark>#list-creation-sympa#2694><tex2html_cross_ref_visible_mark></A>.

<P>
Here is a sample command to modify a list to a family :
 <BLOCKQUOTE>
</BLOCKQUOTE><PRE><tex2html_verbatim_mark>verbatim358#</PRE><BLOCKQUOTE>
</BLOCKQUOTE> 

<P>

<H2><A NAME="SECTION002028000000000000000"><tex2html_anchor_invisible_mark></A>
    <A NAME="list-param-edit-family"><tex2html_anchor_mark></A><BR>
19.2.8 List parameters edition in a family context
</H2>
According to file <A NAME="9483"><tex2html_anchor_invisible_mark></A><TT>edit_list.conf</TT>, edition rights are controlled.  
See <A HREF=<tex2html_cr_mark>#list-edition#2702><tex2html_cr_mark></A>, page~<A HREF=<tex2html_cr_mark>#list-edition#2703><tex2html_cross_ref_visible_mark></A>. But in a family context, constraints parameters are 
added to edition right as it is summarized in this array :
<BR>
<P>
array
<BR>
<P>
Note : In order to preserve list customization for instantiation, every modified parameter (via the Web interface) is noted in the <A NAME="9486"><tex2html_anchor_invisible_mark></A><TT>config_changes</TT> file. 

<P>

