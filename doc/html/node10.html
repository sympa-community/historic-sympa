
<H1><A NAME="SECTION001000000000000000000">
9. WWSympa, Sympa's web interface</A>
</H1>

<P>
WWSympa is <I>Sympa</I>'s web interface.

<P>

<H1><A NAME="SECTION001010000000000000000"><tex2html_anchor_invisible_mark></A>
<A NAME="WWSympa"><tex2html_anchor_mark></A><BR>
9.1 Organization
</H1>

<P>
<A NAME="7825"><tex2html_anchor_invisible_mark></A><I>WWSympa</I> is fully integrated with <I>Sympa</I>. It uses <A NAME="7829"><tex2html_anchor_invisible_mark></A><TT>sympa.conf</TT>
and <I>Sympa</I>'s libraries. The default <I>Sympa</I> installation will also
install WWSympa.

<P>
Every single piece of HTML in <A NAME="7834"><tex2html_anchor_invisible_mark></A><I>WWSympa</I> is generated by the CGI code
using template files (See <A HREF=<tex2html_cr_mark>#tpl-format#1320><tex2html_cr_mark></A>, page~<A HREF=<tex2html_cr_mark>#tpl-format#1321><tex2html_cross_ref_visible_mark></A>).
This facilitates internationalization of pages, as well as per-site
customization. 

<P>
The code consists of one single PERL CGI script, <A NAME="7837"><tex2html_anchor_invisible_mark></A><TT>WWSympa.fcgi</TT>.
To enhance performance you can configure <A NAME="7840"><tex2html_anchor_invisible_mark></A><I>WWSympa</I> to use
FastCGI ; the CGI will be persistent in memory.
<BR>All data will be accessed through the CGI, including web archives.
This is required to allow the authentication scheme to be applied
systematically.

<P>
Authentication is based on passwords stored in the database table
user_table ; if the appropriate <A NAME="7843"><tex2html_anchor_invisible_mark></A><TT>Crypt::CipherSaber</TT> is
installed, password are encrypted in the database using reversible
encryption based on RC4. Otherwise they are stored in clear text.
In both cases reminding of passwords is possible.
 To keep track of authentication information <A NAME="7846"><tex2html_anchor_invisible_mark></A><I>WWSympa</I> 
uses HTTP cookies stored on the client side. The HTTP cookie only 
indicates that a specified e-mail address has been authenticated ;
permissions are evaluated when an action is requested.

<P>
The same web interface is used by the listmaster, list owners, subscribers and
others. Depending on permissions, the same URL may generate a different view.

<P>
<A NAME="7849"><tex2html_anchor_invisible_mark></A><I>WWSympa</I>'s main loop algorithm is roughly the following : 

<OL>
<LI>Check authentication information returned by 
	the HTTP cookie

<P>
</LI>
<LI>Evaluate user's permissions for the
        requested action 

<P>
</LI>
<LI>Process the requested action 

<P>
</LI>
<LI>Set up variables resulting from the action 

<P>
</LI>
<LI>Parse the HTML template files
</LI>
</OL>

<P>

<H1><A NAME="SECTION001020000000000000000">
9.2 Web server setup</A>
</H1>

<P>

<H2><A NAME="SECTION001021000000000000000">
9.2.1 wwsympa.fcgi access permissions</A>
</H2>

<P>
Because Sympa and WWSympa share a lot of files, <A NAME="7852"><tex2html_anchor_invisible_mark></A><TT>wwsympa.fcgi</TT>,
     must run with the same 
     uid/gid as <A NAME="7855"><tex2html_anchor_invisible_mark></A><TT>archived.pl</TT>, <A NAME="7858"><tex2html_anchor_invisible_mark></A><TT>bounced.pl</TT> and <A NAME="7861"><tex2html_anchor_invisible_mark></A><TT>sympa.pl</TT>.
     There are different ways to organize this :

<UL>
<LI>With some operating systems no special setup is required because
      wwsympa.fcgi is installed with suid and sgid bits, but this will not work
      if suid scripts are refused by your system.

<P>
</LI>
<LI>Run a dedicated Apache server with sympa.sympa as uid.gid (The Apache default
      is nobody.nobody)

<P>
</LI>
<LI>Use a Apache virtual host with sympa.sympa as uid.gid ; Apache
      needs to be compiled with suexec. Be aware that the Apache suexec usually define a lowest
      UID/GID allowed to be a target user for suEXEC. For most systems including binaries
      distribution of Apache, the default value 100 is common.
      So Sympa UID (and Sympa GID) must be higher then 100 or suexec must be tuned in order to allow
      lower UID/GID. Check http://httpd.apache.org/docs/suexec.html#install for details

<P>
The User and Group directive have to be set before the FastCgiServer directive
      is encountered.

<P>
</LI>
<LI>Otherwise, you can overcome restrictions on the execution of suid scripts
      by using a short C program, owned by sympa and with the suid bit set, to start
      <A NAME="7864"><tex2html_anchor_invisible_mark></A><TT>wwsympa.fcgi</TT>. Here is an example (with no guarantee attached) :
<BLOCKQUOTE>
</BLOCKQUOTE><PRE><tex2html_verbatim_mark>verbatim297#</PRE><BLOCKQUOTE>
</BLOCKQUOTE>
</LI>
</UL>

<P>

<H2><A NAME="SECTION001022000000000000000">
9.2.2 Installing wwsympa.fcgi in your Apache server</A>
</H2>
     If you chose to run <A NAME="7867"><tex2html_anchor_invisible_mark></A><TT>wwsympa.fcgi</TT> as a simple CGI, you simply need to
     script alias it. 

<P>
<BLOCKQUOTE>
</BLOCKQUOTE><PRE><tex2html_verbatim_mark>verbatim298#</PRE><BLOCKQUOTE>
</BLOCKQUOTE>

<P>
Running  FastCGI will provide much faster responses from your server and 
     reduce load (to understand why, read 
     <A NAME="tex2html21"
  HREF="http://www.fastcgi.com/fcgi-devkit-2.1/doc/fcgi-perf.htm">http://www.fastcgi.com/fcgi-devkit-2.1/doc/fcgi-perf.htm</A>)

<P>
<BLOCKQUOTE>
</BLOCKQUOTE><PRE><tex2html_verbatim_mark>verbatim299#</PRE><BLOCKQUOTE>
</BLOCKQUOTE>

<P>
If you run Virtual robots, then the FastCgiServer(s) can serve multiple robots. 
Therefore you need to define it in the common section of your Apache configuration
file.

<P>

<H2><A NAME="SECTION001023000000000000000">
9.2.3 Using FastCGI</A>
</H2>

<P>
<A NAME="tex2html22"
  HREF="http://www.fastcgi.com/">FastCGI</A>
is an extention to CGI that provides persistency for CGI programs. It is extemely useful
with <A NAME="7870"><tex2html_anchor_invisible_mark></A><I>WWSympa</I> since source code interpretation and all initialisation tasks are performed only once, at server startup ; then
file <#1354#>wwsympa.fcgi<#1354#> instances are waiting for clients requests. 

<P>
<A NAME="7873"><tex2html_anchor_invisible_mark></A><I>WWSympa</I> can also work without FastCGI, depending on the <B>use_fast_cgi</B> parameter 
(see <A HREF=<tex2html_cr_mark>#use-fastcgi#1356><tex2html_cr_mark></A>, page~<A HREF=<tex2html_cr_mark>#use-fastcgi#1357><tex2html_cross_ref_visible_mark></A>).

<P>
To run <A NAME="7876"><tex2html_anchor_invisible_mark></A><I>WWSympa</I> with FastCGI, you need to install :

<UL>
<LI><A NAME="7879"><tex2html_anchor_invisible_mark></A>mod_fastcgi  : the Apache module that provides <A NAME="7880"><tex2html_anchor_invisible_mark></A>FastCGI features

<P>
</LI>
<LI><A NAME="7881"><tex2html_anchor_invisible_mark></A><TT>FCGI</TT> : the Perl module used by <A NAME="7884"><tex2html_anchor_invisible_mark></A><I>WWSympa</I> 

<P>
</LI>
</UL>

<P>

<H1><A NAME="SECTION001030000000000000000">
9.3 wwsympa.conf parameters</A>
</H1>

<P>

<H2><A NAME="SECTION001031000000000000000">
9.3.1 arc_path</A>
</H2>

<P>
(Default value: <TT>/home/httpd/html/arc</TT>) 
<BR>	Where to store html archives. This parameter is used
        by the <A NAME="7888"><tex2html_anchor_invisible_mark></A><TT>archived.pl</TT> daemon. It is a good idea to install the archive
        outside the web hierarchy to prevent possible back doors in the access control
        powered by WWSympa. However, if Apache is configured with a chroot, you may
	have to install the archive in the Apache directory tree.

<P>

<H2><A NAME="SECTION001032000000000000000">
9.3.2 archive_default_index thrd | mail</A>
</H2>

<P>
(Default value: <TT>thrd</TT>) 
<BR>	The default index organization when entering web archives : either threaded or	
	chronological order.

<P>

<H2><A NAME="SECTION001033000000000000000">
9.3.3 archived_pidfile</A>
</H2>
	(Default value: <TT>archived.pid</TT>) 
<BR>	The file containing the PID of <A NAME="7893"><tex2html_anchor_invisible_mark></A><TT>archived.pl</TT>.

<P>

<H2><A NAME="SECTION001034000000000000000">
9.3.4 bounce_path</A>
</H2>
	(Default value: <TT>/var/bounce</TT>) 
<BR>	Root directory for storing bounces (non-delivery reports). This parameter
	is used mainly by the <A NAME="7897"><tex2html_anchor_invisible_mark></A><TT>bounced.pl</TT> daemon.

<P>

<H2><A NAME="SECTION001035000000000000000">
9.3.5 bounced_pidfile</A>
</H2>
	(Default value: <TT>bounced.pid</TT>) 
<BR>	The file containing the PID of <A NAME="7901"><tex2html_anchor_invisible_mark></A><TT>bounced.pl</TT>.

<P>

<H2><A NAME="SECTION001036000000000000000">
9.3.6 cookie_expire</A>
</H2>
	(Default value: <TT>0</TT>)
	Lifetime (in minutes) of HTTP cookies. This is the default value
	when not set explicitly by users.

<P>

<H2><A NAME="SECTION001037000000000000000">
9.3.7 cookie_domain</A>
</H2>
	(Default value: <TT>localhost</TT>) 
<BR>	Domain for the HTTP cookies. If beginning with a dot ('.'),
	the cookie is available within the specified internet domain.
	Otherwise, for the specified host. Example : 
		<BLOCKQUOTE>
</BLOCKQUOTE><PRE><tex2html_verbatim_mark>verbatim300#</PRE><BLOCKQUOTE>
</BLOCKQUOTE>
	The only reason for replacing the default value would be where
	<A NAME="7906"><tex2html_anchor_invisible_mark></A><I>WWSympa</I>'s authentication process is shared with an application
	running on another host.

<P>

<H2><A NAME="SECTION001038000000000000000">
9.3.8 default_home</A>
</H2>
	(Default value: <TT>home</TT>) 
<BR>        Organization of the WWSympa home page. If you have only a few lists,
	the default value `home' (presenting a list of lists organized by topic)
	should be replaced by `lists' (a simple alphabetical list of lists).

<P>

<H2><A NAME="SECTION001039000000000000000">
9.3.9 icons_url</A>
</H2>
	(Default value: <TT>/icons</TT>) 
<BR>	URL of WWSympa's icons directory.

<P>

<H2><A NAME="SECTION0010310000000000000000">
9.3.10 log_facility</A>
</H2>

<P>
WWSympa will log using this facility. Defaults to <I>Sympa</I>'s syslog
        facility.
	Configure your syslog according to this parameter.

<P>

<H2><A NAME="SECTION0010311000000000000000">
9.3.11 mhonarc</A>
</H2>
	(Default value: <TT>/usr/bin/mhonarc</TT>) 
<BR>	Path to the (superb) MhOnArc program. Required for html archives
	http://www.oac.uci.edu/indiv/ehood/mhonarc.html

<P>

<H2><A NAME="SECTION0010312000000000000000">
9.3.12 htmlarea_url</A>
</H2>
	(Default value: <TT>undefined</TT>) 
<BR>	Relative URL to the (superb) online html editor HTMLarea. If you have installed javascript application you can use it
        when editing html document in the shared document repository. In order to activate this pluggin the value of this
        parameter should point to the root directory where HTMLarea is installed.  HTMLarea is a free opensource software you can download
        here : http://sf.net/projects/itools-htmlarea/

<P>

<H2><A NAME="SECTION0010313000000000000000">
9.3.13 password_case sensitive | insensitive</A>
</H2>
	(Default value: <TT>insensitive</TT>) 
<BR>	If set to <B>insensitive</B>, WWSympa's password check will be insensitive.
	This only concerns passwords stored in Sympa database, not the ones in <A NAME="7915"><tex2html_anchor_invisible_mark></A>LDAP.

<P>
<B>Be careful :</B> in previous 3.xx versions of Sympa, passwords were 
	lowercased before database insertion. Therefore changing to case-sensitive 
	password checking could bring you some password checking problems.

<P>

<H2><A NAME="SECTION0010314000000000000000">
9.3.14 title</A>
</H2>
	(Default value: <TT>Mailing List Service</TT>) 
<BR>	The name of your mailing list service. It will appear in
	the Title section of WWSympa.

<P>

<H2><A NAME="SECTION0010315000000000000000"><tex2html_anchor_invisible_mark></A>
	<A NAME="use-fastcgi"><tex2html_anchor_mark></A><BR>
9.3.15 use_fast_cgi   0 | 1
</H2>
	(Default value: <TT>1</TT>) 
<BR>	Choice of whether or not to use FastCGI. On listes.cru.fr, using FastCGI 
        increases WWSympa performance by as much as a factor of 10. Refer to 
       	<A NAME="tex2html23"
  HREF="http://www.fastcgi.com/">http://www.fastcgi.com/</A>
and the Apache config section of this document for details about 
	FastCGI.

<P>

<H1><A NAME="SECTION001040000000000000000">
9.4 MhOnArc</A>
</H1>

<P>
MhOnArc is a neat little converter from mime messages to html. Refer to
<A NAME="tex2html24"
  HREF="http://www.oac.uci.edu/indiv/ehood/mhonarc.html">http://www.oac.uci.edu/indiv/ehood/mhonarc.html</A>.

<P>
The long mhonarc resource file is used by <A NAME="7918"><tex2html_anchor_invisible_mark></A><I>WWSympa</I> in a particular way.
MhOnArc is called to produce not a complete html document, but only a part of it
to be included in a complete document (starting with <TT>;SPMlt;</TT>HTML<TT>;SPMgt;</TT> and terminating
with <TT>;SPMlt;</TT>/HTML<TT>;SPMgt;</TT> ;-) ).
The best way is to use the MhOnArc resource file 
provided in the <A NAME="7921"><tex2html_anchor_invisible_mark></A><I>WWSympa</I> distribution and to modify it for your needs.

<P>
The mhonarc resource file is named <A NAME="7924"><tex2html_anchor_invisible_mark></A><TT>mhonarc-ressources</TT>. 
You may locate this file either in 
<OL>
<LI><A NAME="7927"><tex2html_anchor_invisible_mark></A><TT>/usr/local/sympa-gb/expl/mylist/mhonarc-ressources</TT>
	in order to create a specific archive look for a particular list

<P>
</LI>
<LI>or <A NAME="7930"><tex2html_anchor_invisible_mark></A><TT>/usr/local/sympa-gb/etc/mhonarc-ressources</TT>

<P>
</LI>
</OL>

<P>

<H1><A NAME="SECTION001050000000000000000">
9.5 Archiving daemon</A>
</H1>
<A NAME="7933"><tex2html_anchor_invisible_mark></A><TT>archived.pl</TT> converts messages from <I>Sympa</I>'s spools 
and calls <A NAME="7937"><tex2html_anchor_invisible_mark></A><TT>mhonarc</TT> to create html versions (whose location is defined by the 
;SPMquot;arc_path;SPMquot; WWSympa parameter). You should probably install these archives 
outside the <I>Sympa</I> home_dir (<I>Sympa</I>'s initial choice for storing mail archives : 
<A NAME="7942"><tex2html_anchor_invisible_mark></A><TT>/usr/local/sympa-gb/expl/mylist</TT>). Note that the html archive 
contains a text version of each message and is totally separate from <I>Sympa</I>'s
main archive.

<OL>
<LI>create a directory according to the WWSympa ;SPMquot;arc_path;SPMquot; parameter
    (must be owned by sympa, does not have to be in Apache space unless
    your server uses chroot)

<P>
</LI>
<LI>for each list, if you need a web archive, create a new web archive paragraph
    in the list configuration. Example :
<BLOCKQUOTE>
</BLOCKQUOTE><PRE><tex2html_verbatim_mark>verbatim301#</PRE><BLOCKQUOTE>
</BLOCKQUOTE>

<P>
If web_archive is defined for a list, every message distributed by this list is copied
     to <A NAME="7946"><tex2html_anchor_invisible_mark></A><TT>/usr/local/sympa-gb/spool/outgoing/</TT>. (No need to create nonexistent subscribers to receive
     copies of messages). In this example disk quota for the archive is limited to 10 Mo.

<P>
</LI>
<LI>start <A NAME="7949"><tex2html_anchor_invisible_mark></A><TT>archived.pl</TT>.
<I>Sympa</I> and Apache

<P>
</LI>
<LI>check <A NAME="7953"><tex2html_anchor_invisible_mark></A><I>WWSympa</I> logs, or alternatively, start <A NAME="7956"><tex2html_anchor_invisible_mark></A><TT>archived.pl</TT> in debug mode (-d). 

<P>
</LI>
<LI>If you change mhonarc resources and wish to rebuild the entire archive 
using the new look defined for mhonarc, simply create an empty file named
;SPMquot;.rebuild.mylist@myhost;SPMquot; in <A NAME="7959"><tex2html_anchor_invisible_mark></A><TT>/usr/local/sympa-gb/spool/outgoing</TT>, and make sure that
the owner of this file is <I>Sympa</I>. 

<P>
<BLOCKQUOTE>
</BLOCKQUOTE><PRE><tex2html_verbatim_mark>verbatim302#</PRE><BLOCKQUOTE>
</BLOCKQUOTE>
You can also rebuild web archives from within the admin page of the list.

<P>
Furthermore, if you want to get list's archives, you can do it via the <A NAME="7963"><tex2html_anchor_invisible_mark></A><TT> List-admin menu-;SPMgt; Archive Management</TT>
</LI>
</OL>

<P>

<H1><A NAME="SECTION001060000000000000000">
9.6 Database configuration</A>
</H1>

<P>
<A NAME="7966"><tex2html_anchor_invisible_mark></A><I>WWSympa</I> needs an RDBMS (Relational Database Management System) in order to
run. All database access is performed via the <I>Sympa</I> API. <I>Sympa</I> 
currently interfaces with <A NAME="tex2html25"
  HREF="http://www.mysql.net/">MySQL</A>, <A NAME="tex2html26"
  HREF="http://www.postgresql.pyrenet.fr/">PostgreSQL</A>, <A NAME="tex2html27"
  HREF="http://www.oracle.com/database/">Oracle</A>
and <A NAME="tex2html28"
  HREF="http://www.sybase.com/index_sybase.html">Sybase</A>.

<P>
A database is needed to store user passwords and preferences.
The database structure is documented in the <I>Sympa</I> documentation ;
scripts for creating it are also provided with the <I>Sympa</I> distribution
(in <A NAME="7973"><tex2html_anchor_invisible_mark></A><TT>script</TT>). 

<P>
User information (password and preferences) are stored in the &#171;<#30014#><#30014#>User&#187;<#30015#><#30015#> table.
User passwords stored in the database are encrypted using reversible
RC4 encryption controlled with the <A NAME="7976"><tex2html_anchor_invisible_mark></A><TT>cookie</TT> parameter,
since <A NAME="7979"><tex2html_anchor_invisible_mark></A><I>WWSympa</I> might need to remind users of their passwords. 
The security of <A NAME="7982"><tex2html_anchor_invisible_mark></A><I>WWSympa</I> rests on the security of your database. 

<P>

<H1><A NAME="SECTION001070000000000000000">
9.7 Logging in as listmaster</A>
</H1>

<P>
Once <I>Sympa</I> is running you should log in on the web interface as a privileged user (listmaster)
to explore the admin interface, create mailing lists.

<P>
Multiple email addresses can be declared as listmaster via the <A NAME="7986"><tex2html_anchor_invisible_mark></A><TT>sympa.conf</TT> (or <A NAME="7989"><tex2html_anchor_invisible_mark></A><TT>robot.conf</TT>)
<A NAME="7992"><tex2html_anchor_invisible_mark></A><TT>listmaster</TT> configuration parameter (see <A HREF=<tex2html_cr_mark>#exp-admin#1453><tex2html_cr_mark></A>,  page~<A HREF=<tex2html_cr_mark>#exp-admin#1454><tex2html_cross_ref_visible_mark></A>). Note
that listmasters on the main robot (declared in  <A NAME="7995"><tex2html_anchor_invisible_mark></A><TT>sympa.conf</TT>) also have listmaster privileges on
the virtual robots but they will not receive the various mail notifications (list creation, warnings,...)
regarding these virtual robots.

<P>
The listmasters should log in with their canonical email address as an identifier (not <I>listmaster@my.host</I>).
The associated password is not declared in sympa.conf ; it will be allocated by <I>Sympa</I> when first hitting
the <B>Send me a password</B> button on the web interface. As for any user, the password can then be modified via the 
<B>Preferenced</B> menu.

<P>
Note that you must start the <A NAME="7999"><tex2html_anchor_invisible_mark></A><TT>sympa.pl</TT> process with the web interface ; it is in responsible for delivering 
mail messages including password reminders.

<P>

