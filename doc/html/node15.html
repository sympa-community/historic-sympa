
<H1><A NAME="SECTION001500000000000000000"><tex2html_anchor_invisible_mark></A>
    <A NAME="virtual-robot"><tex2html_anchor_mark></A><BR>
14. Virtual robot
</H1>

<P>
Sympa is designed to manage multiple distinct mailing list servers on
a single host with a single Sympa installation. Sympa virtual robots
are like Apache virtual hosting. Sympa virtual robot definition includes
a specific email address for the robot itself and its lists and also a virtual
http server. Each robot provides access to a set of lists, each list is
related to only one robot.

<P>
Most configuration parameters can be redefined for each robot except 
general Sympa installation parameters (binary and spool location, smtp engine,
antivirus plugging,...).

<P>
The Virtual robot name as defined in <I>Sympa</I> documentation and configuration file refers
to the Internet domaine of the Virtual robot.

<P>
Note that the main limitation of virtual robots in Sympa is that you cannot create 
2 lists with the same name (local part) among your virtual robots.

<P>

<H1><A NAME="SECTION001510000000000000000">
14.1 How to create a virtual robot</A>
</H1>

<P>
You don't need to install several Sympa servers. A single <A NAME="8651"><tex2html_anchor_invisible_mark></A><TT>sympa.pl</TT> daemon
and one or more fastcgi servers can serve all virtual robot. Just configure the 
server environment in order to accept the new domain definition.

<UL>
<LI><B>The DNS</B> must be configured to define a new mail exchanger record (MX) 
to route message to your server. A new host (A record) or alias (CNAME) are mandatory
to define the new web server.
</LI>
<LI>Configure your <B>MTA (sendmail, postfix, exim, ...)</B> to accept incoming 
messages for the new robot domain. Add mail aliases for the robot :

<P>
<I>Examples (with sendmail):</I> 
<BLOCKQUOTE>
</BLOCKQUOTE><PRE><tex2html_verbatim_mark>verbatim333#</PRE><BLOCKQUOTE>
</BLOCKQUOTE>

<P>
</LI>
<LI>Define a <B>virtual host in your HTTPD server</B>. The fastcgi servers defined 
in the common section of you httpd server can be used by each virtual host. You don't 
need to run dedicated fascgi server for each virtual robot.

<P>
<I>Examples:</I> 
<BLOCKQUOTE>
</BLOCKQUOTE><PRE><tex2html_verbatim_mark>verbatim334#</PRE><BLOCKQUOTE>
</BLOCKQUOTE>

<P>
</LI>
<LI>Create a <A NAME="8654"><tex2html_anchor_invisible_mark></A><TT>robot.conf</TT> for the virtual robot (current web interface does
not provide Virtual robot creation yet).

<P>
</LI>
</UL>

<P>

<H1><A NAME="SECTION001520000000000000000">
14.2 robot.conf</A>
</H1>
A robot is named by its domain, let's say my.domain.organd defined by a directory 
<A NAME="8657"><tex2html_anchor_invisible_mark></A><TT>/usr/local/sympa-ff//etc/my.domain.org</TT>. This directory must contain at least a 
<A NAME="8660"><tex2html_anchor_invisible_mark></A><TT>robot.conf</TT> file. This files has the same format as  <A NAME="8663"><tex2html_anchor_invisible_mark></A><TT>/usr/local/sympa-ff//etc/sympa.conf</TT>
(have a look at robot.conf in the sample dir).
Only the following parameters can be redefined for a particular robot :

<P>

<UL>
<LI><A NAME="8666"><tex2html_anchor_invisible_mark></A><TT>http_host</TT> 
<BR>	This hostname will be compared with 'SERVER_NAME' environment variable in wwsympa.fcgi
	to determine the current Virtual Robot. You can a path at the end of this parameter if
	you are running multiple Virtual robots on the same host. 
	<BLOCKQUOTE>
</BLOCKQUOTE><PRE><tex2html_verbatim_mark>verbatim335#</PRE><BLOCKQUOTE>
</BLOCKQUOTE>

<P>
</LI>
<LI><A NAME="8669"><tex2html_anchor_invisible_mark></A><TT>wwsympa_url</TT> 
<BR>	The base URL of WWSympa

<P>
</LI>
<LI><A NAME="8672"><tex2html_anchor_invisible_mark></A><TT>soap_url</TT> 
<BR>	The base URL of Sympa's SOAP server (if it is running ; see ~<A HREF=<tex2html_cr_mark>#soap#1932><tex2html_cr_mark></A>, page~<A HREF=<tex2html_cr_mark>#soap#1933><tex2html_cross_ref_visible_mark></A>)

<P>
</LI>
<LI><A NAME="8675"><tex2html_anchor_invisible_mark></A><TT>cookie_domain</TT>

<P>
</LI>
<LI><A NAME="8678"><tex2html_anchor_invisible_mark></A><TT>email</TT>

<P>
</LI>
<LI><A NAME="8681"><tex2html_anchor_invisible_mark></A><TT>title</TT>

<P>
</LI>
<LI><A NAME="8684"><tex2html_anchor_invisible_mark></A><TT>default_home</TT>

<P>
</LI>
<LI><A NAME="8687"><tex2html_anchor_invisible_mark></A><TT>create_list</TT>

<P>
</LI>
<LI><A NAME="8690"><tex2html_anchor_invisible_mark></A><TT>lang</TT>

<P>
</LI>
<LI><A NAME="8693"><tex2html_anchor_invisible_mark></A><TT>supported_lang</TT>

<P>
</LI>
<LI><A NAME="8696"><tex2html_anchor_invisible_mark></A><TT>log_smtp</TT>

<P>
</LI>
<LI><A NAME="8699"><tex2html_anchor_invisible_mark></A><TT>listmaster</TT>

<P>
</LI>
<LI><A NAME="8702"><tex2html_anchor_invisible_mark></A><TT>max_size</TT>

<P>
</LI>
<LI><A NAME="8705"><tex2html_anchor_invisible_mark></A><TT>css_path</TT>

<P>
</LI>
<LI><A NAME="8708"><tex2html_anchor_invisible_mark></A><TT>css_url</TT>

<P>
</LI>
<LI><A NAME="8711"><tex2html_anchor_invisible_mark></A><TT>logo_html_definition</TT>

<P>
</LI>
<LI><A NAME="8714"><tex2html_anchor_invisible_mark></A><TT>color_0</TT>, <#1948#>color_1<#1948#> ... <#1949#>color_15<#1949#>

<P>
</LI>
<LI>deprecated color definition <A NAME="8717"><tex2html_anchor_invisible_mark></A><TT>dark_color</TT>, <A NAME="8720"><tex2html_anchor_invisible_mark></A><TT>light_color</TT>, <A NAME="8723"><tex2html_anchor_invisible_mark></A><TT>text_color</TT>, <A NAME="8726"><tex2html_anchor_invisible_mark></A><TT>bg_color</TT>, <A NAME="8729"><tex2html_anchor_invisible_mark></A><TT>error_color</TT>, <A NAME="8732"><tex2html_anchor_invisible_mark></A><TT>selected_color</TT>, <A NAME="8735"><tex2html_anchor_invisible_mark></A><TT>shaded_color</TT>

<P>
</LI>
</UL>

<P>
These settings overwrite the equivalent global parameter defined in <A NAME="8738"><tex2html_anchor_invisible_mark></A><TT>/usr/local/sympa-ff//etc/sympa.conf</TT>
for my.domain.orgrobot ; the main <A NAME="8741"><tex2html_anchor_invisible_mark></A><TT>listmaster</TT> still has privileges on Virtual
Robots though. The http_host parameter is compared by wwsympa with the SERVER_NAME
environment variable to recognize which robot is in used. 

<P>

<H2><A NAME="SECTION001521000000000000000">
14.2.1 Robot customization</A>
</H2>

<P>
In order to customize the web look and feel, you may edit the CSS definition. CSS are defined in a template named css.tt2. Any robot can use static css file for making Sympa web interface faster. Then you can edit this static definition and change web style. Please refer to  <A NAME="8744"><tex2html_anchor_invisible_mark></A><TT>css_path</TT> <A NAME="8747"><tex2html_anchor_invisible_mark></A><TT>css_url</TT>. You can also quickly introduce a logo in left top corner of all pages configuring <A NAME="8750"><tex2html_anchor_invisible_mark></A><TT>logo_html_definition</TT> parameter in robot.conf file. 

<P>
In addition, if needed, you can customize each virtual robot using its set of templates and authorization scenarios. 

<P>
<A NAME="8753"><tex2html_anchor_invisible_mark></A><TT>/usr/local/sympa-ff//etc/my.domain.org/wws_templates/</TT>,
<A NAME="8756"><tex2html_anchor_invisible_mark></A><TT>/usr/local/sympa-ff//etc/my.domain.org/templates/</TT>, 
<A NAME="8759"><tex2html_anchor_invisible_mark></A><TT>/usr/local/sympa-ff//etc/my.domain.org/scenari/</TT> directories are searched when
loading templates or scenari before searching into <A NAME="8762"><tex2html_anchor_invisible_mark></A><TT>/usr/local/sympa-ff//etc</TT> and  <A NAME="8765"><tex2html_anchor_invisible_mark></A><TT>/usr/local/sympa-ff//bin/etc</TT>. This allows to define different privileges and a different GUI for a Virtual Robot.

<P>

<H1><A NAME="SECTION001530000000000000000">
14.3 Managing multiple virtual robots</A>
</H1>

<P>
If you are managing more than 2 virtual robots, then you might cinsider moving all the mailing lists in the default
robot to a dedicated virtual robot located in the <A NAME="8768"><tex2html_anchor_invisible_mark></A><TT>/usr/local/sympa-ff//expl/my.domain.org/</TT> directory. The main benefit of 
this organisation is the ability to define default configuration elements (templates or authorization scenarios) 
for this robot without inheriting them within other virtual robots.

<P>
To create such a virtual robot, you need to create <A NAME="8771"><tex2html_anchor_invisible_mark></A><TT>/usr/local/sympa-ff//expl/my.domain.org/</TT> and <A NAME="8774"><tex2html_anchor_invisible_mark></A><TT>/usr/local/sympa-ff//etc/my.domain.org/</TT> directories ; 
customize <A NAME="8777"><tex2html_anchor_invisible_mark></A><TT>host</TT>, <A NAME="8780"><tex2html_anchor_invisible_mark></A><TT>http_host</TT> and <A NAME="8783"><tex2html_anchor_invisible_mark></A><TT>wwsympa_url</TT> parameters in the <A NAME="8786"><tex2html_anchor_invisible_mark></A><TT>/usr/local/sympa-ff//etc/my.domain.org/robot.conf</TT> 
with the same values as the default robot (as defined in <A NAME="8789"><tex2html_anchor_invisible_mark></A><TT>sympa.conf</TT> and <A NAME="8792"><tex2html_anchor_invisible_mark></A><TT>wwsympa.conf</TT> files).

<P>

